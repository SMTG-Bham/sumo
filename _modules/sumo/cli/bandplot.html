
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>sumo.cli.bandplot &#8212; sumo 2.1.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for sumo.cli.bandplot</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">A script to plot electronic band structure diagrams.</span>

<span class="sd">TODO:</span>
<span class="sd"> - Replace the elements and project formats with the dream syntax</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>
<span class="kn">from</span> <span class="nn">pkg_resources</span> <span class="kn">import</span> <span class="n">Requirement</span><span class="p">,</span> <span class="n">resource_filename</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">from</span> <span class="nn">pymatgen.io.vasp.outputs</span> <span class="kn">import</span> <span class="n">BSVasprun</span>
<span class="kn">from</span> <span class="nn">pymatgen.electronic_structure.core</span> <span class="kn">import</span> <span class="n">Spin</span>
<span class="kn">from</span> <span class="nn">pymatgen.electronic_structure.bandstructure</span> <span class="kn">import</span> \
    <span class="n">get_reconstructed_band_structure</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sumo.io.questaal</span> <span class="kn">import</span> <span class="n">QuestaalInit</span><span class="p">,</span> <span class="n">QuestaalSite</span><span class="p">,</span> <span class="n">labels_from_syml</span>
<span class="kn">from</span> <span class="nn">sumo.io.questaal</span> <span class="kn">import</span> <span class="n">band_structure</span> <span class="k">as</span> <span class="n">questaal_band_structure</span>
<span class="kn">from</span> <span class="nn">sumo.io.castep</span> <span class="kn">import</span> <span class="n">band_structure</span> <span class="k">as</span> <span class="n">castep_band_structure</span>
<span class="kn">from</span> <span class="nn">sumo.io.castep</span> <span class="kn">import</span> <span class="n">read_tdos</span> <span class="k">as</span> <span class="n">read_castep_tdos</span>
<span class="kn">from</span> <span class="nn">sumo.plotting.bs_plotter</span> <span class="kn">import</span> <span class="n">SBSPlotter</span>
<span class="kn">from</span> <span class="nn">sumo.plotting.dos_plotter</span> <span class="kn">import</span> <span class="n">SDOSPlotter</span>
<span class="kn">from</span> <span class="nn">sumo.electronic_structure.dos</span> <span class="kn">import</span> <span class="n">load_dos</span>
<span class="kn">from</span> <span class="nn">sumo.electronic_structure.bandstructure</span> <span class="kn">import</span> <span class="n">string_to_spin</span>
<span class="kn">from</span> <span class="nn">sumo.cli.dosplot</span> <span class="kn">import</span> <span class="n">_atoms</span><span class="p">,</span> <span class="n">_el_orb</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">configparser</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ConfigParser</span> <span class="k">as</span> <span class="nn">configparser</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Alex Ganose&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;1.0&quot;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s2">&quot;Alex Ganose&quot;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s2">&quot;alexganose@googlemail.com&quot;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s2">&quot;July 18, 2017&quot;</span>


<div class="viewcode-block" id="bandplot"><a class="viewcode-back" href="../../../sumo.cli.html#sumo.cli.bandplot.bandplot">[docs]</a><span class="k">def</span> <span class="nf">bandplot</span><span class="p">(</span><span class="n">filenames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="s1">&#39;vasp&#39;</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">vbm_cbm_marker</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">projection_selection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rgb&#39;</span><span class="p">,</span>
             <span class="n">interpolate_factor</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">circle_size</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">dos_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">cart_coords</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scissor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">,</span> <span class="n">dos_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">elements</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lm_orbitals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">total_only</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_total</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend_cutoff</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">gaussian</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=-</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span> <span class="n">colours</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">yscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">no_base_style</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">image_format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">plt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fonts</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Plot electronic band structure diagrams from vasprun.xml files.</span>

<span class="sd">    Args:</span>
<span class="sd">        filenames (:obj:`str` or :obj:`list`, optional): Path to input files:</span>

<span class="sd">            Vasp:</span>
<span class="sd">                Use vasprun.xml or vasprun.xml.gz file.</span>
<span class="sd">            Questaal:</span>
<span class="sd">                Path to a bnds.ext file. The extension will also be used to</span>
<span class="sd">                find site.ext and syml.ext files in the same directory.</span>
<span class="sd">            Castep:</span>
<span class="sd">                Path to a seedname.bands file. The prefix (&quot;seedname&quot;) is used</span>
<span class="sd">                to locate a seedname.cell file in the same directory and read</span>
<span class="sd">                in the positions of high-symmetry points.</span>

<span class="sd">            If no filenames are provided, sumo</span>
<span class="sd">            will search for vasprun.xml or vasprun.xml.gz files in folders</span>
<span class="sd">            named &#39;split-0*&#39;. Failing that, the code will look for a vasprun in</span>
<span class="sd">            the current directory. If a :obj:`list` of vasprun files is</span>
<span class="sd">            provided, these will be combined into a single band structure.</span>

<span class="sd">        code (:obj:`str`, optional): Calculation type. Default is &#39;vasp&#39;;</span>
<span class="sd">            &#39;questaal&#39; and &#39;castep&#39; also supported (with a reduced</span>
<span class="sd">            feature-set).</span>
<span class="sd">        prefix (:obj:`str`, optional): Prefix for file names.</span>
<span class="sd">        directory (:obj:`str`, optional): The directory in which to save files.</span>
<span class="sd">        vbm_cbm_marker (:obj:`bool`, optional): Plot markers to indicate the</span>
<span class="sd">            VBM and CBM locations.</span>
<span class="sd">        projection_selection (list): A list of :obj:`tuple` or :obj:`string`</span>
<span class="sd">            identifying which elements and orbitals to project on to the</span>
<span class="sd">            band structure. These can be specified by both element and</span>
<span class="sd">            orbital, for example, the following will project the Bi s, p</span>
<span class="sd">            and S p orbitals::</span>

<span class="sd">                [(&#39;Bi&#39;, &#39;s&#39;), (&#39;Bi&#39;, &#39;p&#39;), (&#39;S&#39;, &#39;p&#39;)]</span>

<span class="sd">            If just the element is specified then all the orbitals of</span>
<span class="sd">            that element are combined. For example, to sum all the S</span>
<span class="sd">            orbitals::</span>

<span class="sd">                [(&#39;Bi&#39;, &#39;s&#39;), (&#39;Bi&#39;, &#39;p&#39;), &#39;S&#39;]</span>

<span class="sd">            You can also choose to sum particular orbitals by supplying a</span>
<span class="sd">            :obj:`tuple` of orbitals. For example, to sum the S s, p, and</span>
<span class="sd">            d orbitals into a single projection::</span>

<span class="sd">                [(&#39;Bi&#39;, &#39;s&#39;), (&#39;Bi&#39;, &#39;p&#39;), (&#39;S&#39;, (&#39;s&#39;, &#39;p&#39;, &#39;d&#39;))]</span>

<span class="sd">            If ``mode = &#39;rgb&#39;``, a maximum of 3 orbital/element</span>
<span class="sd">            combinations can be plotted simultaneously (one for red, green</span>
<span class="sd">            and blue), otherwise an unlimited number of elements/orbitals</span>
<span class="sd">            can be selected.</span>
<span class="sd">        mode (:obj:`str`, optional): Type of projected band structure to</span>
<span class="sd">            plot. Options are:</span>

<span class="sd">                &quot;rgb&quot;</span>
<span class="sd">                    The band structure line color depends on the character</span>
<span class="sd">                    of the band. Each element/orbital contributes either</span>
<span class="sd">                    red, green or blue with the corresponding line colour a</span>
<span class="sd">                    mixture of all three colours. This mode only supports</span>
<span class="sd">                    up to 3 elements/orbitals combinations. The order of</span>
<span class="sd">                    the ``selection`` :obj:`tuple` determines which colour</span>
<span class="sd">                    is used for each selection.</span>
<span class="sd">                &quot;stacked&quot;</span>
<span class="sd">                    The element/orbital contributions are drawn as a</span>
<span class="sd">                    series of stacked circles, with the colour depending on</span>
<span class="sd">                    the composition of the band. The size of the circles</span>
<span class="sd">                    can be scaled using the ``circle_size`` option.</span>
<span class="sd">        circle_size (:obj:`float`, optional): The area of the circles used</span>
<span class="sd">            when ``mode = &#39;stacked&#39;``.</span>
<span class="sd">        cart_coords (:obj:`bool`, optional): Whether the k-points are read as</span>
<span class="sd">            cartesian or reciprocal coordinates. This is only required for</span>
<span class="sd">            Questaal output; Vasp output is less ambiguous. Defaults to</span>
<span class="sd">            ``False`` (fractional coordinates).</span>
<span class="sd">        scissor (:obj:`float`, optional): Apply a scissor operator (rigid shift</span>
<span class="sd">            of the CBM), use with caution if applying to metals.</span>
<span class="sd">        dos_file (:obj:&#39;str&#39;, optional): Path to vasprun.xml file from which to</span>
<span class="sd">            read the density of states information. If set, the density of</span>
<span class="sd">            states will be plotted alongside the bandstructure.</span>
<span class="sd">        elements (:obj:`dict`, optional): The elements and orbitals to extract</span>
<span class="sd">            from the projected density of states. Should be provided as a</span>
<span class="sd">            :obj:`dict` with the keys as the element names and corresponding</span>
<span class="sd">            values as a :obj:`tuple` of orbitals. For example, the following</span>
<span class="sd">            would extract the Bi s, px, py and d orbitals::</span>

<span class="sd">                {&#39;Bi&#39;: (&#39;s&#39;, &#39;px&#39;, &#39;py&#39;, &#39;d&#39;)}</span>

<span class="sd">            If an element is included with an empty :obj:`tuple`, all orbitals</span>
<span class="sd">            for that species will be extracted. If ``elements`` is not set or</span>
<span class="sd">            set to ``None``, all elements for all species will be extracted.</span>
<span class="sd">        lm_orbitals (:obj:`dict`, optional): The orbitals to decompose into</span>
<span class="sd">            their lm contributions (e.g. p -&gt; px, py, pz). Should be provided</span>
<span class="sd">            as a :obj:`dict`, with the elements names as keys and a</span>
<span class="sd">            :obj:`tuple` of orbitals as the corresponding values. For example,</span>
<span class="sd">            the following would be used to decompose the oxygen p and d</span>
<span class="sd">            orbitals::</span>

<span class="sd">                {&#39;O&#39;: (&#39;p&#39;, &#39;d&#39;)}</span>

<span class="sd">        atoms (:obj:`dict`, optional): Which atomic sites to use when</span>
<span class="sd">            calculating the projected density of states. Should be provided as</span>
<span class="sd">            a :obj:`dict`, with the element names as keys and a :obj:`tuple` of</span>
<span class="sd">            :obj:`int` specifying the atomic indices as the corresponding</span>
<span class="sd">            values. The elemental projected density of states will be summed</span>
<span class="sd">            only over the atom indices specified. If an element is included</span>
<span class="sd">            with an empty :obj:`tuple`, then all sites for that element will</span>
<span class="sd">            be included. The indices are 0 based for each element specified in</span>
<span class="sd">            the POSCAR. For example, the following will calculate the density</span>
<span class="sd">            of states for the first 4 Sn atoms and all O atoms in the</span>
<span class="sd">            structure::</span>

<span class="sd">                {&#39;Sn&#39;: (1, 2, 3, 4), &#39;O&#39;: (, )}</span>

<span class="sd">            If ``atoms`` is not set or set to ``None`` then all atomic sites</span>
<span class="sd">            for all elements will be considered.</span>
<span class="sd">        spin (:obj:`Spin`, optional): Plot only one spin channel from a</span>
<span class="sd">            spin-polarised calculation; &quot;up&quot; or &quot;1&quot; for spin up only, &quot;down&quot; or</span>
<span class="sd">            &quot;-1&quot; for spin down only. Defaults to ``None``.</span>
<span class="sd">        total_only (:obj:`bool`, optional): Only extract the total density of</span>
<span class="sd">            states. Defaults to ``False``.</span>
<span class="sd">        plot_total (:obj:`bool`, optional): Plot the total density of states.</span>
<span class="sd">            Defaults to ``True``.</span>
<span class="sd">        legend_cutoff (:obj:`float`, optional): The cut-off (in % of the</span>
<span class="sd">            maximum density of states within the plotting range) for an</span>
<span class="sd">            elemental orbital to be labelled in the legend. This prevents</span>
<span class="sd">            the legend from containing labels for orbitals that have very</span>
<span class="sd">            little contribution in the plotting range.</span>
<span class="sd">        gaussian (:obj:`float`, optional): Broaden the density of states using</span>
<span class="sd">            convolution with a gaussian function. This parameter controls the</span>
<span class="sd">            sigma or standard deviation of the gaussian distribution.</span>
<span class="sd">        height (:obj:`float`, optional): The height of the plot.</span>
<span class="sd">        width (:obj:`float`, optional): The width of the plot.</span>
<span class="sd">        ymin (:obj:`float`, optional): The minimum energy on the y-axis.</span>
<span class="sd">        ymax (:obj:`float`, optional): The maximum energy on the y-axis.</span>
<span class="sd">        style (:obj:`list` or :obj:`str`, optional): (List of) matplotlib style</span>
<span class="sd">            specifications, to be composed on top of Sumo base style.</span>
<span class="sd">        no_base_style (:obj:`bool`, optional): Prevent use of sumo base style.</span>
<span class="sd">            This can make alternative styles behave more predictably.</span>
<span class="sd">        colours (:obj:`dict`, optional): Use custom colours for specific</span>
<span class="sd">            element and orbital combinations. Specified as a :obj:`dict` of</span>
<span class="sd">            :obj:`dict` of the colours. For example::</span>

<span class="sd">                {</span>
<span class="sd">                    &#39;Sn&#39;: {&#39;s&#39;: &#39;r&#39;, &#39;p&#39;: &#39;b&#39;},</span>
<span class="sd">                    &#39;O&#39;: {&#39;s&#39;: &#39;#000000&#39;}</span>
<span class="sd">                }</span>

<span class="sd">            The colour can be a hex code, series of rgb value, or any other</span>
<span class="sd">            format supported by matplotlib.</span>
<span class="sd">        yscale (:obj:`float`, optional): Scaling factor for the y-axis.</span>
<span class="sd">        image_format (:obj:`str`, optional): The image file format. Can be any</span>
<span class="sd">            format supported by matplotlib, including: png, jpg, pdf, and svg.</span>
<span class="sd">            Defaults to pdf.</span>
<span class="sd">        dpi (:obj:`int`, optional): The dots-per-inch (pixel density) for</span>
<span class="sd">            the image.</span>
<span class="sd">        plt (:obj:`matplotlib.pyplot`, optional): A</span>
<span class="sd">            :obj:`matplotlib.pyplot` object to use for plotting.</span>
<span class="sd">        fonts (:obj:`list`, optional): Fonts to use in the plot. Can be a</span>
<span class="sd">            a single font, specified as a :obj:`str`, or several fonts,</span>
<span class="sd">            specified as a :obj:`list` of :obj:`str`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        If ``plt`` set then the ``plt`` object will be returned. Otherwise, the</span>
<span class="sd">        method will return a :obj:`list` of filenames written to disk.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">filenames</span><span class="p">:</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">find_vasprun_files</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">filenames</span><span class="p">]</span>

    <span class="c1"># only load the orbital projects if we definitely need them</span>
    <span class="n">parse_projected</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">projection_selection</span> <span class="k">else</span> <span class="kc">False</span>

    <span class="c1"># now load all the band structure data and combine using the</span>
    <span class="c1"># get_reconstructed_band_structure function from pymatgen</span>
    <span class="n">bandstructures</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;vasp&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">vr_file</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="n">vr</span> <span class="o">=</span> <span class="n">BSVasprun</span><span class="p">(</span><span class="n">vr_file</span><span class="p">,</span> <span class="n">parse_projected_eigen</span><span class="o">=</span><span class="n">parse_projected</span><span class="p">)</span>
            <span class="n">bs</span> <span class="o">=</span> <span class="n">vr</span><span class="o">.</span><span class="n">get_band_structure</span><span class="p">(</span><span class="n">line_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">bandstructures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
        <span class="n">bs</span> <span class="o">=</span> <span class="n">get_reconstructed_band_structure</span><span class="p">(</span><span class="n">bandstructures</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;castep&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">bands_file</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="n">cell_file</span> <span class="o">=</span> <span class="n">bands_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;bands&#39;</span><span class="p">,</span> <span class="s1">&#39;cell&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">cell_file</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;found cell file </span><span class="si">{}</span><span class="s1">...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell_file</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;did not find cell file </span><span class="si">{}</span><span class="s1">...&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell_file</span><span class="p">))</span>
                <span class="n">cell_file</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">bs</span> <span class="o">=</span> <span class="n">castep_band_structure</span><span class="p">(</span><span class="n">bands_file</span><span class="p">,</span> <span class="n">cell_file</span><span class="o">=</span><span class="n">cell_file</span><span class="p">)</span>
            <span class="n">bandstructures</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
        <span class="n">bs</span> <span class="o">=</span> <span class="n">get_reconstructed_band_structure</span><span class="p">(</span><span class="n">bandstructures</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;questaal&#39;</span><span class="p">:</span>
        <span class="n">bnds_file</span> <span class="o">=</span> <span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">bnds_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">bnds_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bnds_file</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">pardir</span><span class="p">)</span>

        <span class="n">site_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bnds_folder</span><span class="p">,</span> <span class="s1">&#39;site.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">site_file</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;site file found, reading lattice...&#39;</span><span class="p">)</span>
            <span class="n">site_data</span> <span class="o">=</span> <span class="n">QuestaalSite</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">site_file</span><span class="p">)</span>
            <span class="n">bnds_lattice</span> <span class="o">=</span> <span class="n">site_data</span><span class="o">.</span><span class="n">structure</span><span class="o">.</span><span class="n">lattice</span>
            <span class="n">alat</span> <span class="o">=</span> <span class="n">site_data</span><span class="o">.</span><span class="n">alat</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Site file </span><span class="si">{}</span><span class="s1"> not found: &#39;</span>
                          <span class="s1">&#39;needed to determine lattice&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site_file</span><span class="p">))</span>

        <span class="n">syml_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bnds_folder</span><span class="p">,</span> <span class="s1">&#39;syml.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">syml_file</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;syml file found, reading special-point labels...&#39;</span><span class="p">)</span>
            <span class="n">bnds_labels</span> <span class="o">=</span> <span class="n">labels_from_syml</span><span class="p">(</span><span class="n">syml_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;syml file not found, band structure lacks labels&#39;</span><span class="p">)</span>
            <span class="n">bnds_labels</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">bs</span> <span class="o">=</span> <span class="n">questaal_band_structure</span><span class="p">(</span><span class="n">bnds_file</span><span class="p">,</span> <span class="n">bnds_lattice</span><span class="p">,</span> <span class="n">alat</span><span class="o">=</span><span class="n">alat</span><span class="p">,</span>
                                     <span class="n">labels</span><span class="o">=</span><span class="n">bnds_labels</span><span class="p">,</span>
                                     <span class="n">coords_are_cartesian</span><span class="o">=</span><span class="n">cart_coords</span><span class="p">)</span>

    <span class="c1"># currently not supported as it is a pain to make subplots within subplots,</span>
    <span class="c1"># although need to check this is still the case</span>
    <span class="k">if</span> <span class="s1">&#39;split&#39;</span> <span class="ow">in</span> <span class="n">mode</span> <span class="ow">and</span> <span class="n">dos_file</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ERROR: Plotting split projected band structure with DOS&#39;</span>
                      <span class="s1">&#39; not supported.</span><span class="se">\n</span><span class="s1">Please use --projected-rgb or &#39;</span>
                      <span class="s1">&#39;--projected-stacked options.&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">projection_selection</span> <span class="ow">and</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;rgb&#39;</span>
            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">projection_selection</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ERROR: RGB projected band structure only &#39;</span>
                      <span class="s1">&#39;supports up to 3 elements/orbitals.&#39;</span>
                      <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Use alternative --mode setting.&#39;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="c1"># don&#39;t save if pyplot object provided</span>
    <span class="n">save_files</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">plt</span> <span class="k">else</span> <span class="kc">True</span>

    <span class="n">dos_plotter</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">dos_opts</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">dos_file</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;vasp&#39;</span><span class="p">:</span>
            <span class="n">dos</span><span class="p">,</span> <span class="n">pdos</span> <span class="o">=</span> <span class="n">load_dos</span><span class="p">(</span><span class="n">dos_file</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">lm_orbitals</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">gaussian</span><span class="p">,</span>
                                 <span class="n">total_only</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;castep&#39;</span><span class="p">:</span>
            <span class="n">dos</span> <span class="o">=</span> <span class="n">read_castep_tdos</span><span class="p">(</span><span class="n">dos_file</span><span class="p">,</span> <span class="n">gaussian</span><span class="o">=</span><span class="n">gaussian</span><span class="p">,</span>
                                   <span class="n">efermi_to_vbm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">emin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">emax</span><span class="o">=</span><span class="n">ymax</span><span class="p">)</span>
            <span class="n">pdos</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dos_plotter</span> <span class="o">=</span> <span class="n">SDOSPlotter</span><span class="p">(</span><span class="n">dos</span><span class="p">,</span> <span class="n">pdos</span><span class="p">)</span>
        <span class="n">dos_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;plot_total&#39;</span><span class="p">:</span> <span class="n">plot_total</span><span class="p">,</span> <span class="s1">&#39;legend_cutoff&#39;</span><span class="p">:</span> <span class="n">legend_cutoff</span><span class="p">,</span>
                    <span class="s1">&#39;colours&#39;</span><span class="p">:</span> <span class="n">colours</span><span class="p">,</span> <span class="s1">&#39;yscale&#39;</span><span class="p">:</span> <span class="n">yscale</span><span class="p">}</span>

    <span class="k">if</span> <span class="n">scissor</span><span class="p">:</span>
        <span class="n">bs</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">apply_scissor</span><span class="p">(</span><span class="n">scissor</span><span class="p">)</span>

    <span class="n">spin</span> <span class="o">=</span> <span class="n">string_to_spin</span><span class="p">(</span><span class="n">spin</span><span class="p">)</span> <span class="c1"># Convert spin argument to pymatgen Spin object</span>
    <span class="n">plotter</span> <span class="o">=</span> <span class="n">SBSPlotter</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">projection_selection</span><span class="p">:</span>
        <span class="n">plt</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">get_projected_plot</span><span class="p">(</span>
            <span class="n">projection_selection</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
            <span class="n">interpolate_factor</span><span class="o">=</span><span class="n">interpolate_factor</span><span class="p">,</span> <span class="n">circle_size</span><span class="o">=</span><span class="n">circle_size</span><span class="p">,</span>
            <span class="n">zero_to_efermi</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">vbm_cbm_marker</span><span class="o">=</span><span class="n">vbm_cbm_marker</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
            <span class="n">plt</span><span class="o">=</span><span class="n">plt</span><span class="p">,</span> <span class="n">dos_plotter</span><span class="o">=</span><span class="n">dos_plotter</span><span class="p">,</span> <span class="n">dos_options</span><span class="o">=</span><span class="n">dos_opts</span><span class="p">,</span>
            <span class="n">dos_label</span><span class="o">=</span><span class="n">dos_label</span><span class="p">,</span> <span class="n">fonts</span><span class="o">=</span><span class="n">fonts</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
            <span class="n">no_base_style</span><span class="o">=</span><span class="n">no_base_style</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="n">spin</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span> <span class="o">=</span> <span class="n">plotter</span><span class="o">.</span><span class="n">get_plot</span><span class="p">(</span>
            <span class="n">zero_to_efermi</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">vbm_cbm_marker</span><span class="o">=</span><span class="n">vbm_cbm_marker</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
            <span class="n">plt</span><span class="o">=</span><span class="n">plt</span><span class="p">,</span> <span class="n">dos_plotter</span><span class="o">=</span><span class="n">dos_plotter</span><span class="p">,</span> <span class="n">dos_options</span><span class="o">=</span><span class="n">dos_opts</span><span class="p">,</span>
            <span class="n">dos_label</span><span class="o">=</span><span class="n">dos_label</span><span class="p">,</span> <span class="n">fonts</span><span class="o">=</span><span class="n">fonts</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
            <span class="n">no_base_style</span><span class="o">=</span><span class="n">no_base_style</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="n">spin</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save_files</span><span class="p">:</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="s1">&#39;band.</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">image_format</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">basename</span><span class="p">)</span> <span class="k">if</span> <span class="n">prefix</span> <span class="k">else</span> <span class="n">basename</span>
        <span class="k">if</span> <span class="n">directory</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">image_format</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
                    <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

        <span class="n">written</span> <span class="o">=</span> <span class="p">[</span><span class="n">filename</span><span class="p">]</span>
        <span class="n">written</span> <span class="o">+=</span> <span class="n">save_data_files</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">,</span>
                                   <span class="n">directory</span><span class="o">=</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">written</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">plt</span></div>


<div class="viewcode-block" id="find_vasprun_files"><a class="viewcode-back" href="../../../sumo.cli.html#sumo.cli.bandplot.find_vasprun_files">[docs]</a><span class="k">def</span> <span class="nf">find_vasprun_files</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Search for vasprun files from the current directory.</span>

<span class="sd">    The precedence order for file locations is:</span>

<span class="sd">      1. First search for folders named: &#39;split-0*&#39;</span>
<span class="sd">      2. Else, look in the current directory.</span>

<span class="sd">    The split folder names should always be zero based, therefore easily</span>
<span class="sd">    sortable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">folders</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;split-*&#39;</span><span class="p">)</span>
    <span class="n">folders</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">folders</span><span class="p">)</span> <span class="k">if</span> <span class="n">folders</span> <span class="k">else</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">]</span>

    <span class="n">filenames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">fol</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
        <span class="n">vr_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fol</span><span class="p">,</span> <span class="s1">&#39;vasprun.xml&#39;</span><span class="p">)</span>
        <span class="n">vr_file_gz</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fol</span><span class="p">,</span> <span class="s1">&#39;vasprun.xml.gz&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">vr_file</span><span class="p">):</span>
            <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vr_file</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">vr_file_gz</span><span class="p">):</span>
            <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vr_file_gz</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;ERROR: No vasprun.xml found in </span><span class="si">{}</span><span class="s1">!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fol</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">filenames</span></div>


<div class="viewcode-block" id="save_data_files"><a class="viewcode-back" href="../../../sumo.cli.html#sumo.cli.bandplot.save_data_files">[docs]</a><span class="k">def</span> <span class="nf">save_data_files</span><span class="p">(</span><span class="n">bs</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Write the band structure data files to disk.</span>

<span class="sd">    Args:</span>
<span class="sd">        bs (`BandStructureSymmLine`): Calculated band structure.</span>
<span class="sd">        prefix (`str`, optional): Prefix for data file.</span>
<span class="sd">        directory (`str`, optional): Directory in which to save the data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The filename of the written data file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">_band.dat&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="k">if</span> <span class="n">prefix</span> <span class="k">else</span> <span class="s1">&#39;band.dat&#39;</span>
    <span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span> <span class="k">if</span> <span class="n">directory</span> <span class="k">else</span> <span class="s1">&#39;.&#39;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">bs</span><span class="o">.</span><span class="n">is_metal</span><span class="p">():</span>
        <span class="n">zero</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">efermi</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">zero</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">get_vbm</span><span class="p">()[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;#k-distance eigenvalue[eV]</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>

        <span class="c1"># write the spin up eigenvalues</span>
        <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">bs</span><span class="o">.</span><span class="n">bands</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">up</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bs</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.8f}</span><span class="s1"> </span><span class="si">{:.8f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">e</span> <span class="o">-</span> <span class="n">zero</span><span class="p">))</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># calculation is spin polarised, write spin down bands at end of file</span>
        <span class="k">if</span> <span class="n">bs</span><span class="o">.</span><span class="n">is_spin_polarized</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="n">bs</span><span class="o">.</span><span class="n">bands</span><span class="p">[</span><span class="n">Spin</span><span class="o">.</span><span class="n">down</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bs</span><span class="o">.</span><span class="n">distance</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.8f}</span><span class="s1"> </span><span class="si">{:.8f}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">e</span> <span class="o">-</span> <span class="n">zero</span><span class="p">))</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">filename</span></div>


<span class="k">def</span> <span class="nf">_el_orb_tuple</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse the element and orbital argument strings.</span>

<span class="sd">    The presence of an element without any orbitals means that we want to plot</span>
<span class="sd">    all of its orbitals.</span>

<span class="sd">    Args:</span>
<span class="sd">        string (`str`): The selected elements and orbitals in in the form:</span>
<span class="sd">            `&quot;Sn.s.p,O&quot;`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A list of tuples specifying which elements/orbitals to plot. The output</span>
<span class="sd">        for the above example would be:</span>

<span class="sd">            `[(&#39;Sn&#39;, (&#39;s&#39;, &#39;p&#39;)), &#39;O&#39;]`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">el_orbs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">split</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span>
        <span class="n">splits</span> <span class="o">=</span> <span class="n">split</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">el</span> <span class="o">=</span> <span class="n">splits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">splits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">el_orbs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">el_orbs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">el</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">splits</span><span class="p">[</span><span class="mi">1</span><span class="p">:])))</span>
    <span class="k">return</span> <span class="n">el_orbs</span>


<span class="k">def</span> <span class="nf">_get_parser</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    bandplot is a script to produce publication-ready band</span>
<span class="s2">    structure diagrams&quot;&quot;&quot;</span><span class="p">,</span>
                                     <span class="n">epilog</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Author: </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">    Version: </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">    Last updated: </span><span class="si">{}</span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__author__</span><span class="p">,</span> <span class="n">__version__</span><span class="p">,</span> <span class="n">__date__</span><span class="p">))</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;--filenames&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span>
                        <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;one or more vasprun.xml files to plot&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;--code&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;vasp&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Electronic structure code (default: vasp).&#39;</span>
                             <span class="s1">&#39;&quot;questaal&quot; also supported.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="s1">&#39;--prefix&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;P&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;prefix for the files generated&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-d&#39;</span><span class="p">,</span> <span class="s1">&#39;--directory&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;output directory for files&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="s1">&#39;--band-edges&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;band_edges&#39;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;highlight the band edges with markers&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--project&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="n">_el_orb_tuple</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;projection_selection&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;select which orbitals to project onto the band &#39;</span>
                              <span class="s1">&#39;structure (e.g. &quot;Zn.s,Zn.p,O&quot;)&#39;</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--mode&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;rgb&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;mode for orbital projections (options: rgb, &#39;</span>
                              <span class="s1">&#39;stacked)&#39;</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--interpolate-factor&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;interpolate_factor&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;interpolate factor for band structure &#39;</span>
                              <span class="s1">&#39;projections (default: 4)&#39;</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--cartesian&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Read cartesian k-point coordinates. This is only&#39;</span>
                             <span class="s1">&#39; necessary for some Questaal calculations; Vasp &#39;</span>
                             <span class="s1">&#39;outputs are less ambiguous and this option will &#39;</span>
                             <span class="s1">&#39;be ignored if --code=vasp.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--circle-size&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
                        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;circle_size&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;circle size for &quot;stacked&quot; projections &#39;</span>
                              <span class="s1">&#39;(default: 150)&#39;</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--ylabel&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;Energy (eV)&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;y-axis (i.e. energy) label/units&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--dos-label&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;dos_label&#39;</span><span class="p">,</span>
                        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Axis label for DOS if included&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--dos&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;path to density of states vasprun.xml&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--elements&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">_el_orb</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;E&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;elemental orbitals to plot (e.g. &quot;C.s.p,O&quot;)&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--orbitals&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">_el_orb</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;O&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;orbitals to split into lm-decomposed &#39;</span>
                              <span class="s1">&#39;contributions (e.g. &quot;Ru.d&quot;)&#39;</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--atoms&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">_atoms</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;atoms to include (e.g. &quot;O.1.2.3,Ru.1.2.3&quot;)&#39;</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--spin&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;select only one spin channel for a spin-polarised &#39;</span>
                              <span class="s1">&#39;calculation (options: up, 1; down, -1)&#39;</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--scissor&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;scissor&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;apply scissor operator&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--total-only&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;total_only&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;only plot the total density of states&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--no-total&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_false&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;total&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;don</span><span class="se">\&#39;</span><span class="s1">t plot the total density of states&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--legend-cutoff&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;legend_cutoff&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;cut-off in </span><span class="si">%%</span><span class="s1"> of total DOS that determines if&#39;</span>
                              <span class="s1">&#39; a line is given a label (default: 3)&#39;</span><span class="p">))</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-g&#39;</span><span class="p">,</span> <span class="s1">&#39;--gaussian&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;G&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;standard deviation of DOS gaussian broadening&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--scale&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;scaling factor for the density of states&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--height&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;height of the graph&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--width&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;width of the graph&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--ymin&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=-</span><span class="mf">6.</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;minimum energy on the y-axis&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--ymax&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">6.</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;maximum energy on the y-axis&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--style&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;matplotlib style specifications&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--no-base-style&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;no_base_style&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;prevent use of sumo base style&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--config&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;colour configuration file&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--format&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span>
                        <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;image_format&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;FORMAT&#39;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;image file format (options: pdf, svg, jpg, png)&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--dpi&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;pixel density for image file&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--font&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;font to use&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parser</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">_get_parser</span><span class="p">()</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;sumo-bandplot.log&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
                        <span class="n">filemode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">console</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[:]))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">console</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">resource_filename</span><span class="p">(</span><span class="n">Requirement</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;sumo&#39;</span><span class="p">),</span>
                                        <span class="s1">&#39;sumo.plotting/orbital_colours.conf&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">config_path</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">config</span>
    <span class="n">colours</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
    <span class="n">colours</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">config_path</span><span class="p">))</span>

    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">,</span>
                            <span class="n">module</span><span class="o">=</span><span class="s2">&quot;matplotlib&quot;</span><span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UnicodeWarning</span><span class="p">,</span>
                            <span class="n">module</span><span class="o">=</span><span class="s2">&quot;matplotlib&quot;</span><span class="p">)</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">,</span>
                            <span class="n">module</span><span class="o">=</span><span class="s2">&quot;pymatgen&quot;</span><span class="p">)</span>

    <span class="n">bandplot</span><span class="p">(</span><span class="n">filenames</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">filenames</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span>
             <span class="n">directory</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">vbm_cbm_marker</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">band_edges</span><span class="p">,</span>
             <span class="n">projection_selection</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">projection_selection</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
             <span class="n">interpolate_factor</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">interpolate_factor</span><span class="p">,</span>
             <span class="n">cart_coords</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">cartesian</span><span class="p">,</span> <span class="n">scissor</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">scissor</span><span class="p">,</span>
             <span class="n">circle_size</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">circle_size</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">scale</span><span class="p">,</span>
             <span class="n">ylabel</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">dos_label</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">dos_label</span><span class="p">,</span>
             <span class="n">dos_file</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">dos</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span>
             <span class="n">lm_orbitals</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">orbitals</span><span class="p">,</span> <span class="n">atoms</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">atoms</span><span class="p">,</span> <span class="n">spin</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">spin</span><span class="p">,</span>
             <span class="n">total_only</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">total_only</span><span class="p">,</span> <span class="n">plot_total</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
             <span class="n">legend_cutoff</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">legend_cutoff</span><span class="p">,</span> <span class="n">gaussian</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">gaussian</span><span class="p">,</span>
             <span class="n">height</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span>
             <span class="n">style</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">style</span><span class="p">,</span> <span class="n">no_base_style</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">no_base_style</span><span class="p">,</span>
             <span class="n">ymax</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span> <span class="n">colours</span><span class="o">=</span><span class="n">colours</span><span class="p">,</span> <span class="n">image_format</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">image_format</span><span class="p">,</span>
             <span class="n">dpi</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span> <span class="n">fonts</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">font</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">sumo</a></h1>



<p class="blurb">Heavy weight plotting tools</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=SMTG-UCL&repo=sumo&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gallery.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">Python API</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Scanlon Materials Theory Group.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>